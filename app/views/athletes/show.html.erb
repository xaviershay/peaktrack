<h1><%= @athlete.name %></h1>
<img src=<%= @athlete.profile_photo_url %> />

<ul>
<% @regions.sort_by(&:name).each do |region| %>
  <li><%= link_to region.name, "/athlete/%i/region/%i" % [@athlete.id, region.id] %></li>
<% end %>
</ul>

<div id="map" style="height: 400px"></div>

<script>
  var map = L.map('map').fitBounds(<%= @summary.map {|x| [x.lat, x.lon] }.to_json %>);
   // setView([51.505, -0.09], 13);
  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1,
      accessToken: 'pk.eyJ1IjoieGF2aWVyc2hheSIsImEiOiJja3dpZTE0b3IxN29mMm5xYjhjZzhrdzdqIn0.4bYtnMoe9RITuMFJePSgMg'
  }).addTo(map);
  var summitedIcon = L.icon({
    iconUrl: "<%= asset_path("mountain.png") %>",
    iconSize: [60, 50],
    className: 'map-icon-summited'
  });
  var unsummitedIcon = L.icon({
    iconUrl: "<%= asset_path("mountain-grey.png") %>",
    iconSize: [60, 50],
    className: 'map-icon-unsummited'
  });
  <% @summary.each do |x| %>
    L.marker([<%= x.lat %>, <%= x.lon %>], {
      icon: <%= x.activity_id ? "summitedIcon" : "unsummitedIcon" %>,
      zIndexOffset: <%= x.activity_id ? 1000 : 0 %>
    })
      .bindPopup("<%= "%s, %im" % [x.name, x.elevation] %>")
      .addTo(map);
  <% end %>
</script>

<table>
  <tr>
    <th>Peak</th>
    <th>Elevation</th>
    <th>Summits</th>
    <th>Most Recent</th>
  </tr>
<% @summary.each do |rp| %>
  <tr>
    <td><%= rp.name %></td>
    <td><%= rp.elevation %></td>
    <% if rp.activity_id %>
      <td><%= rp.summit_count %>
      <td><%= link_to rp.started_at.strftime("%-d %b, %Y"), "https://www.strava.com/activities/%i" % rp.activity_id %></td>
    <% end %>
  </tr>
<% end %>
</table>
